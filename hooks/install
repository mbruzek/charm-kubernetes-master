#!/bin/bash

set -ex

# Add the the key for the docker repository.
apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 36A1D7869245C8950F966E92D8576A8BA88D21E9
echo deb https://get.docker.com/ubuntu docker main > /etc/apt/sources.list.d/docker.list

apt-get update -qq
apt-get install -y -q \
    build-essential \
    git \
    golang-go \
    libssl-dev \
    libffi-dev \
    lxc-docker \
    make \
    nginx \
    python-dev \
    python-pip \
    wget

pip install path.py

VERSION=`config-get version`
ARCH=`dpkg --print-architecture`
REPOSITORY="https://github.com/GoogleCloudPlatform/kubernetes.git"
KUBERNETES_DIRECTORY="/opt/kubernetes"

if [ -d $KUBERNETES_DIRECTORY ]; then
  rm -rf $KUBERNETES_DIRECTORY
fi

git clone $REPOSITORY $KUBERNETES_DIRECTORY

# Open port 8080 for nginx.
open-port 8080
